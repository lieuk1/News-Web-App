<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/home.css') }}">

    <title>{{ title }}</title>
</head>
<body>
    <div class="landing-container">
        <!-- Button for trending headlines -->
        <div class="btn-container">
            <ul>
                <li id="trending-btn" value="trending-btn" onclick="openForm('my-top-form')">
                    View trending articles
                    <!-- Number of span equals number of bubbles that appear on hover -->
                    <span></span><span></span>
                    <span></span><span></span>
                </li>
            </ul>
        </div>
    </div>
    <div id="categ-btns-container" class="categ-btns-container">
        <ul class="nav nav-tabs justify-content-center" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">Hot</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="health-tab" data-bs-toggle="tab" data-bs-target="#health" type="button" role="tab" aria-controls="health" aria-selected="false">Health</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="science-tab" data-bs-toggle="tab" data-bs-target="#science" type="button" role="tab" aria-controls="science" aria-selected="false">Science</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="entertainment-tab" data-bs-toggle="tab" data-bs-target="#entertainment" type="button" role="tab" aria-controls="entertainment" aria-selected="false">Entertainment</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="technology-tab" data-bs-toggle="tab" data-bs-target="#technology" type="button" role="tab" aria-controls="technology" aria-selected="false">Technology</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="business-tab" data-bs-toggle="tab" data-bs-target="#business" type="button" role="tab" aria-controls="business" aria-selected="false">Business</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sports-tab" data-bs-toggle="tab" data-bs-target="#sports" type="button" role="tab" aria-controls="sports" aria-selected="false">Sports</button>
            </li>
        </ul>
    </div>
    <div class="tab-content" id="myTabContent">
        {% for c in categories %}
        {% if loop.first %}
        <div class="tab-pane fade show active" id="{{ c }}" role="tabpanel" aria-labelledby="{{ c }}-tab">
        {% else %}
        <div class="tab-pane fade" id="{{ c }}" role="tabpanel" aria-labelledby="{{ categories[i] }}-tab">
        {% endif %}
            <!-- articles.html -->
        </div>
        {% endfor %}
    </div>
    <nav aria-label="page-nav">
        <ul class="pagination justify-content-center" data-current-pg="{{ page }}">
            {% if page != 1 %}
            <li class="page-item"><a href="{{ url_for('home', page=1) }}" class="page-link">First</a></li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link">First</a>
            </li>
            {% endif %}

            <li class="page-item">
                <button class="page-link" id="prev" href="#">Previous</button>
            </li>

            <li class="page-item"><a class="page-link" id="page-num" href="#">{{ page }}</a></li>

            <li class="page-item">
                <button class="page-link" id="next" href="#">Next</button>
            </li>
            
            <li class="page-item disabled"><a class="page-link">Last</a></li>
        </ul>
    </nav>
    <div class="footer-container">
        <a href="/">Link</a>
        <a href="/">Link</a>
    </div>

    
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- Put all JS in separate file -->
<script>
    var active_tab;
    var pagination_action;
    var current_pg;
    var pages;

    // Document loads
    $(document).ready(function() {
        active_tab = $(".nav-link.active").attr("aria-controls");
        current_pg = $(".pagination").attr("data-current-pg");
        ajaxReq(active_tab, current_pg);
        $("#prev").parent().addClass("disabled");
    });

    // Category tab buttons clicked
    $(".nav-item button").click(function() {
        // Set active tab
        active_tab = $(".nav-link.active").attr("aria-controls");

        // Reset current page number
        current_pg = 1;
        $("#page-num").text(`${current_pg}`);

        ajaxReq(active_tab, current_pg);

        // Enable next pagination btn
        $("#next").parent().removeClass("disabled");
        // Disable previous pagination btn
        $("#prev").parent().addClass("disabled");
    });

    // Pagination buttons clicked
    $(".page-link").click(function() {
        pagination_action = $(this).attr("id");

        console.log(current_pg);
        console.log(pages);

        // If paginating to next page and not on last page, iterate page number
        if (pagination_action === "next" && current_pg != pages) {
            // Iterate page number
            current_pg = parseInt(current_pg) + 1;
            $("#prev").parent().removeClass("disabled");
        }
        // If paginating to prev page and not on first page
        else if (pagination_action === "prev" && current_pg != 1) {
            current_pg = parseInt(current_pg) - 1;
            $("#next").parent().removeClass("disabled");
        }
        
        if (current_pg == pages) {
            $(this).parent().addClass("disabled");
        }
        if (current_pg == 1) {
            $(this).parent().addClass("disabled");
        }

        // Update current page number
        $("#page-num").text(`${current_pg}`);
        
        ajaxReq(active_tab, current_pg);
    });

    function ajaxReq(active_tab, current_pg) {
        $.ajax({
            url: "/articles",
            type: "get",
            data: {category: active_tab, page: current_pg},
            success: function(response) {
                // Update articles
                $(`#myTabContent div[id='${active_tab}']`).replaceWith(response);
                // Set total number of pages
                pages = $(`#myTabContent div[id='${active_tab}']`).attr("data-pages");
            },
            error: function(xhr) {
                console.log(xhr);
            }
        });
    }
</script>
</body>
</html>