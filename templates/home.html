<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/home.css') }}">

    <title>{{ title }}</title>
</head>
<body>
    <div class="landing-container">
        <!-- Button for trending headlines -->
        <div class="btn-container">
            <ul>
                <li id="trending-btn" value="trending-btn" onclick="openForm('my-top-form')">
                    View trending articles
                    <!-- Number of span equals number of bubbles that appear on hover -->
                    <span></span><span></span>
                    <span></span><span></span>
                </li>
            </ul>
        </div>
        <div class="trend-row-con container">
            <div class="row">
                {% for article in articles[0].items %}
                <div class="col trend-article">
                    <div class="trend-article-content">
                        <!-- <p id="publish-date">{{ article.publish_date }}</p> -->
                        <p id="title">{{ article.title }}</p>
                        <p id="source">{{ article.source }}</p>
                    </div>
                    <a href="{{ article.url }}" target="_blank" rel="noopener noreferrer">
                        <img src="{{ article.url_to_image }}" />
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <div id="categ-btns-container" class="categ-btns-container">
        <ul class="nav nav-tabs justify-content-center" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">Hot</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="health-tab" data-bs-toggle="tab" data-bs-target="#health" type="button" role="tab" aria-controls="health" aria-selected="false">Health</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="science-tab" data-bs-toggle="tab" data-bs-target="#science" type="button" role="tab" aria-controls="science" aria-selected="false">Science</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="entertainment-tab" data-bs-toggle="tab" data-bs-target="#entertainment" type="button" role="tab" aria-controls="entertainment" aria-selected="false">Entertainment</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="technology-tab" data-bs-toggle="tab" data-bs-target="#technology" type="button" role="tab" aria-controls="technology" aria-selected="false">Technology</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="business-tab" data-bs-toggle="tab" data-bs-target="#business" type="button" role="tab" aria-controls="business" aria-selected="false">Business</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sports-tab" data-bs-toggle="tab" data-bs-target="#sports" type="button" role="tab" aria-controls="sports" aria-selected="false">Sports</button>
            </li>
        </ul>
    </div>
    <div class="tab-content" id="myTabContent">
        {% for i in range(0, lenCat) %}
        {% if i == 0 %}
        <div class="tab-pane fade show active" id="{{ categories[i] }}" role="tabpanel" aria-labelledby="{{ categories[i] }}-tab">
        {% else %}
        <div class="tab-pane fade" id="{{ categories[i] }}" role="tabpanel" aria-labelledby="{{ categories[i] }}-tab">
        {% endif %}
            <div class="articles-container container">
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4">
                    {% for article in articles[i].items %}
                    <div class="article">
                        <div class="card h-100 article-content">
                            <div class="article-img">
                                <img src="{{ article.url_to_image }}" alt="image" />
                                <span></span>
                            </div>
                            <div class="card-body article-info">
                                <!-- <p id="publish-date">{{ article.publish_date }}</p> -->
                            <p class="article-src text-muted">{{ article.source }}</p>
                            <p class="article-title"><strong>{{ article.title }}</strong></p>
                            </div>
                            <a href="{{ article.url }}" target="_blank" rel="noopener noreferrer">
                                <span></span>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    <nav aria-label="page-nav">
        <ul class="pagination justify-content-center">
            {% if page != 1 %}
            <li class="page-item"><a href="{{ url_for('home', page=1) }}" class="page-link">First</a></li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link">First</a>
            </li>
            {% endif %}

            <!-- <li class="page-item">
                <a href="#" class="page-link">Previous</a>
            </li> -->
            <li class="page-item disabled">
                <a class="page-link">Previous</a>
            </li>

            <li class="page-item"><a class="page-link" id="page-num" href="#">{{ page }}</a></li>

            <li class="page-item">
                <a class="page-link" id="next1" href="#">Next</a>
            </li>
            <li class="page-item disabled">
                <a class="page-link">Next</a>
            </li>
            
            <!-- <li class="page-item"><a href="#" class="page-link">Last</a></li> -->
            <li class="page-item disabled"><a class="page-link">Last</a></li>
        </ul>
    </nav>
    <button id="next">Next</button>
    <div class="footer-container">
        <a href="/">Link</a>
        <a href="/">Link</a>
    </div>

    
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- Put all JS in separate file -->
<script>
    var current_tab;
    var prev_tab;
    var tab_val;
    // TODO: Reset page number when clicking on new tab
    $(document).ready(function() {
        $(".nav-tabs button").on("show.bs.tab", function(e) {
            current_tab = e.target;
            prev_tab = e.relatedTarget;
        });
    });
    $("#next").click(function() {
        if(typeof current_tab === "undefined") {
            tab_val = "general";
        }
        else {
            tab_val = current_tab["attributes"]["aria-controls"]["value"];
        }
        // console.log(current_tab);
        // console.log(tab_val);
    });

    $("#next").click(function() {
        var action = $(this).attr("id");
        var page = $("#page-num").text();
        var next_pg = parseInt(page) + 1;
        console.log(page);
        console.log(next_pg);
        console.log(tab_val);
        $("#page-num").text(`${next_pg}`);
        $.ajax({
           url: "/articles",
           type: "get",
           data: {category: tab_val, action: action, page: next_pg},
           success: function(response) {
            //    console.log(response);
               $(`#myTabContent div[id='${tab_val}']`).replaceWith(response);
           },
           error: function(xhr) {
               console.log(xhr);
           }
        });
    });

    function openForm(form_id) {
        hideButtons()
        document.getElementById(form_id).style.display = "block";
    }
    function closeForm(form_id) {
        document.getElementById(form_id).style.display = "none";
        showButtons()
    }
    function showButtons() {
        document.getElementById("trending-btn").style.display = "inline-block";
    }
    function hideButtons() {
        document.getElementById("trending-btn").style.display = "none";
    }
</script>
</body>
</html>